---
- name: Gather and collect host details
  hosts: all
  gather_facts: true
  vars_files:
    - ../vars/var_set1.yml
  tasks:
    - name: Collect host details
      set_fact:
        host_info: |
          host: {{ inventory_hostname }}
            flavour: {{ ansible_os_family }}
            cpu_cores: {{ ansible_processor_vcpus }}
            memory: {{ ansible_memtotal_mb }}mb
            processor: {{ ansible_processor[-1] }}
      register: collected_info
      delegate_facts: true

- name: Write all host details to file on host1
  hosts: host1
  gather_facts: false
  tasks:
    - name: Remove the existing host details file (optional)
      file:
        path: "{{ config_file_path }}"
        state: absent

    - name: Ensure destination directory exists
      file:
        path: "{{ config_dir_path }}"
        state: directory
        mode: '0755'

    - name: Create host details file with all hostsâ€™ info
      copy:
        dest: "{{ config_file_path }}"
        content: |
          {% for host in groups['all'] %}
          {{ hostvars[host].host_info }}
          {% endfor %}
